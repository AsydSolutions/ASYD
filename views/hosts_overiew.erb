<div class="row">
	<div class="span6">
		<div class="widget widget-table action-table">
			<div class="widget-header">
				<i class="icon-sitemap"></i><h3>Host Groups</h3>
			</div>
			<div class="widget-content">
				<div style="position:absolute; margin:10px; z-index:90;">
					<a data-toggle="modal" href="#addGroup" class="btn">
						Add group <i class="btn-icon-only icon-plus"></i>
					</a>
				</div>
				<div class="visible-phone visible-tablet"><br></br></div>
				<table id="hgtable" class="stripe row-border">
					<thead style="text-align:left;">
						<tr>
							<th>
								Name
							</th>
							<th>
								Hosts
							</th>
							<th class="td-actions">
								Actions
							</th>
						</tr>
					</thead>
					<tbody>
						<% @groups.each do |group| %>
						<tr>
							<td>
								<%=group.name%>
							</td>
							<td>
								<div class="accordion-group accordion-invisible">
									<div class="accordion-heading accordion-invisible">
										<% if group.members_status(:failed) == 0 %>
											<a data-toggle="collapse" href="#collapse<%=group.name%>" style="font-size: 8pt; color: #ffffff;" class="badge badge-success"><%=group.members_status(:total)%>/<%=group.members_status(:sane)%></a>
										<% else %>
											<a data-toggle="collapse" href="#collapse<%=group.name%>" data-placement="right" data-original-title="<%=group.members_status(:failed)%> host(s) on this group has issues" style="font-size: 8pt; color: #ffffff;" class="badge badge-warning hint "><%=group.members_status(:total)%>/<%=group.members_status(:sane)%></a>
										<% end %>
									</div>
									<div id="collapse<%=group.name%>" class="accordion-body collapse accordion-invisible">
										<div class="accordion-inner accordion-invisible">
											<table class="table table-condensed">
												<tbody>
													<% group.hosts.each do |host| %>
													<tr class="accordion-invisible"><td class="accordion-invisible">
														<i class="icon-angle-right"></i>
														<a href="/host/<%=host.hostname%>">
														<% if @host_status[host.hostname] == 1 %>
															<span class="label label-success">
														<% elsif @host_status[host.hostname] == 2 %>
															<span class="label label-warning">
														<% elsif@host_status[host.hostname] == 3 %>
															<span class="label label-important">
														<% elsif @host_status[host.hostname] == 4 %>
															<span class="label">
														<% end %><%= host.hostname %></span>
														</a>
													</td></tr>
													<% end %>
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</td>
							<td class="td-actions">
								<a data-toggle="tooltip" data-original-title="Details" href="/hostgroup/<%=group.name%>" class="btn btn-info btn-mini btn-icon-only hint"><i class="btn-icon-only icon-folder-open"></i></a>
								<a data-toggle="tooltip" data-original-title="Remove" href="#delGroup" class="btn btn-danger btn-mini btn-icon-only hint" onclick="passDataToModal('<%=group.name%>', '#delGroup')"><i class="btn-icon-only icon-remove"></i></a>
							</td>
						</tr>
						<% end %>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<div class="span6">
		<div class="widget widget-table action-table">
			<div class="widget-header">
				<i class="icon-hdd"></i><h3>Hosts</h3>
			</div>
			<div class="widget-content">
				<div style="position:absolute; margin:10px; z-index:90;">
					<a data-toggle="modal" href="#addServer" class="btn">
						Add host <i class="btn-icon-only icon-plus"></i>
					</a>
				</div>
				<div class="visible-phone visible-tablet"><br></br></div>
				<table id="htable" class="stripe row-border">
					<thead style="text-align:left;">
						<tr>
							<th>
								Hostname
							</th>
							<th>
								Status
							</th>
							<th class="td-actions">
								Actions
							</th>
						</tr>
					</thead>
					<tbody>
						<% @hosts.each do |host| %>
						<tr>
							<td>
								<%=host.hostname%>
							</td>
							<td>
								<% if @host_status[host.hostname] == 1 %>
	              	<span class="label label-success">all ok</span>
								<% elsif @host_status[host.hostname] == 2 %>
									<span class="label label-warning">warning</span>
								<% elsif @host_status[host.hostname] == 3 %>
									<span class="label label-important">down</span>
								<% elsif @host_status[host.hostname] == 4 %>
									<span class="label">not monitored</span>
								<% end %>
							</td>
							<td class="td-actions">
								<a data-toggle="tooltip" data-original-title="Details" href="/host/<%=host.hostname%>" class="btn btn-info btn-mini btn-icon-only hint"><i class="btn-icon-only icon-folder-open"></i></a>
								<a data-toggle="tooltip" data-original-title="Reboot" href="#rebootServer" class="btn btn-inverse btn-mini btn-icon-only hint" onclick="passDataToModal('<%=host.hostname%>', '#rebootServer')"><i class="btn-icon-only icon-repeat"></i></a>
								<a data-toggle="tooltip" data-original-title="Remove" href="#delServer" class="btn btn-danger btn-mini btn-icon-only hint" onclick="passDataToModal('<%=host.hostname%>', '#delServer')"><i class="btn-icon-only icon-remove"></i></a>
							</td>
						</tr>
						<% end %>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>


<div id="addServer" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="Add Host" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		<h3 id="addServerLabel">Add new server</h3>
	</div>
	<form id="addServerform" action="/host/add" method="post">
		<div class="modal-body">
			<div class="control-group"><input autocomplete="off" name='hostname' type="text" class="input" placeholder="Hostname" autofocus required><span class="help-inline">hostname (must be unique)</span></div>
			<div class="control-group"><input autocomplete="off" name='ip' type="text" class="input" placeholder="IP address" data-validation-regex-regex="(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" data-validation-regex-message="Must be a valid IP address" required><span class="help-inline">IP address (must be unique)</span><p class="help-block"></p></div>
			<div class="control-group"><input autocomplete="off" name='user' type="text" class="input" placeholder="username" value="root" required><span class="help-inline">user (must have admin privileges)</span></div>
			<div class="control-group"><input autocomplete="off" name='ssh_port' type="number" class="input" value="22" required><span class="help-inline">ssh port</span></div>
			<div class="control-group"><input name='password' type="password" class="input" placeholder="password" required><span class="help-inline">password (won't be stored)</span></div>
		</div>
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
			<button type="submit" class="btn btn-primary">Deploy!</button>
		</div>
	</form>
</div>


<div id="addGroup" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="Add Hostgroup" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		<h3 id="addServerLabel">Add new hostgroup</h3>
	</div>
	<form id="addGroupform" action="/hostgroup/add" method="post">
		<div class="modal-body">
			<div class="control-group"><input autocomplete="off" name='hostgroup' type="text" class="input-xlarge" placeholder="Name" autofocus required></div>
		</div>
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
			<button type="submit" class="btn btn-primary">Add</button>
		</div>
	</form>
</div>


<div id="rebootServer" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="Reboot Host" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		<h3 id="rebootServerLabel">Attention!</h3>
	</div>
	<div class="modal-body">
		<p>Are you sure you want to reboot <b id="dataInput"></b>?</p>
	</div>
	<div class="modal-footer">
		<form id="rebootServerform" action="/host/reboot" method="post">
			<input type="hidden" name="hostname" id="dataInput" value="">
			<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
			<button type="submit" class="btn btn-primary">Reboot</button>
		</form>
	</div>
</div>


<div id="delServer" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="Remove Host" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		<h3 id="delServerLabel">Attention!</h3>
	</div>
	<div class="modal-body">
		<p>Are you sure you want to delete <b id="dataInput"></b> from your server list?</p>
	</div>
	<div class="modal-footer">
		<form id="delServerform" action="/host/del" method="post">
			<input type="hidden" name="hostname" id="dataInput" value="">
			<div style="float:left" class="control-group"><input type="checkbox" name="revoke" value="true"> Revoke SSH key</div>
			<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
			<button type="submit" class="btn btn-primary">Delete</button>
		</form>
	</div>
</div>


<div id="delGroup" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="Remove Hostgroup" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		<h3 id="delGroupLabel">Attention!</h3>
	</div>
	<div class="modal-body">
		<p>Are you sure you want to delete <b id="dataInput"></b> hostgroup?</p>
	</div>
	<div class="modal-footer">
		<form id="delGroupform" action="/hostgroup/del" method="post">
			<input type="hidden" name="hostgroup" id="dataInput" value="">
			<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
			<button type="submit" class="btn btn-primary">Delete</button>
		</form>
	</div>
</div>
